Create DATABASE INFO_CULTURA;

USE INFO_CULTURA;

CREATE TABLE usuarios (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(255) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    tipo_usuario ENUM('comum', 'membro_neabi') NOT NULL,
    senha VARCHAR(60) NOT NULL
);

CREATE TABLE calendario (
    id INT AUTO_INCREMENT PRIMARY KEY
); 

CREATE TABLE eventos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome_evento VARCHAR(255) NOT NULL,
    descricao_evento TEXT NOT NULL,
    data_hora DATETIME NOT NULL,
    local_evento VARCHAR(255) NOT NULL,
    banner BLOB(1500) DEFAULT NULL COMMENT 'URL do banner do evento',
    fotos BLOB(1500) DEFAULT NULL COMMENT 'JSON com array de URLs ou caminhos de fotos do evento (usado em eventos passados)',
    resultados_impacto TEXT DEFAULT NULL COMMENT 'Resumo dos resultados do evento, se aplic치vel',
    status_evento BOOLEAN DEFAULT FALSE COMMENT 'Indica se foi aprovado por super admin',
    id_usuario INT NOT NULL COMMENT 'Usu치rio que cadastrou o evento',
    id_calendario INT DEFAULT NULL COMMENT 'Relacionamento com o calend치rio cultural',
    id_evento_original INT DEFAULT NULL COMMENT 'Se for um evento passado, pode referenciar o evento futuro original',
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    atualizado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (id_usuario) REFERENCES usuarios(id),
    FOREIGN KEY (id_calendario) REFERENCES calendario(id),
    FOREIGN KEY (id_evento_original) REFERENCES eventos(id)
);

CREATE TABLE datas_culturais (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome_data VARCHAR(255) NOT NULL,
    descricao TEXT,
    data_numero DATE NOT NULL,
    importancia TEXT,
    imagem BLOB(1500),
    id_calendario INT NOT NULL,
    FOREIGN KEY (id_calendario) REFERENCES calendario(id)
);

CREATE TABLE aprovacao_eventos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    id_evento INT NOT NULL,
    statuss BOOLEAN NOT NULL,  -- TRUE para aprovado, FALSE para rejeitado
    comentario TEXT DEFAULT NULL,  -- Coment치rio do administrador
    data_aprovacao TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (id_evento) REFERENCES eventos(id)
);
